#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require "droonga/http-benchmark"
require "optparse"

options = {}
option_parser = OptionParser.new do |parser|
  parser.on("--duration=SECONDS", Float,
            "duration of the benmark") do |duration|
    options[:duration] = duration
  end
  parser.on("--wait=SECONDS", Float,
            "wait for each request") do |wait|
    options[:wait] = wait
  end
  parser.on("--n-threads=N", Integer,
            "number of threads") do |n_threads|
    options[:n_threads] = n_threads
  end
end
args = option_parser.parse!(ARGV)

if options[:duration].nil?
  raise "You must specify the test duration by --duration option."
end
if options[:threads].nil?
  raise "You must specify the count of request threads by --threads option."
end

benchmark = Droonga::HttpBenchmark.new(:duration => options[:duration],
                                       :wait => options[:wait],
                                       :n_threads => options[:n_threads])
benchmark.run
